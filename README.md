# E-commerce
MSA 패턴을 기반으로 Spring Cloud, Kafka, Redis 등을 활용해 확장성과 안정성을 갖춘 E-commerce 플랫폼

# 프로젝트 구조
![msa 구성도 예시](https://github.com/user-attachments/assets/448c8e92-a30b-42ca-80b5-9e379c7777bd)
# 기술 스택
Vue.js, TypeScript, Spring Boot 3.3, Spring Data JPA, Spring Cloud Gateway, Spring Cloud Config, H2, Querydsl, Kafka, Rabbitmq

# 서비스 기능

* user-service
  * 회원가입, 로그인 등 유저와 관련된 서비스
  * 유저의 배송지에 관련된 서비스

* item-service
  * 상품 등록, 수정, 삭제 등 상품과 관련된 서비스

* order-service
  * 주문 및 장바구니를 관리하는 서비스

* review-service
  * 리뷰 등록, 수정, 삭제 등 리뷰와 관련된 서비스

* image-service
  * 이미지 등록, 수정 삭제 등 이미지와 관련된 서비스

* pay-service
  * 결제의 검증 및 취소 등 결제와 관련된 서비스
 
 
# 문제 해결

### 결제 서비스에서 Kafka를 활용한 분산 트랜잭션 처리 및 데이터 일관성 보장

* 문제
  * 결제 서비스와 주문 서비스가 분산 환경에서 각각 독립적으로 동작하다 보니, 트랜잭션이 발생할 때 데이터 일관성을 유지하는 데 어려움이 있었습니다. 예를 들어, 결제가 성공했지만 주문 생성이 실패하거나, 주문이 생성되었으나 결제가 완료되지 않는 상황이 발생할 수 있었습니다.

* 해결

  * Kafka를 사용하여 결제와 주문 간의 데이터 흐름을 메시지 기반으로 비동기 처리하면서 SAGA 패턴을 적용했습니다.
  1. 결제 서비스에서 결제가 성공적으로 완료되면 Kafka 토픽으로 결제 완료 메시지를 발행합니다.
  2. 주문 서비스는 해당 메시지를 구독하여 주문 생성 로직을 실행합니다.
  3. 만약 주문 생성이 실패할 경우, 보상 트랜잭션을 통해 Kafka를 통해 결제 취소 이벤트를 발행하여 결제 상태를 롤백합니다.

* 결과  
  * 결제와 주문 상태가 메시지 기반으로 동기화되며, 실패 시 롤백 로직으로 데이터의 정합성이 유지되었습니다.
 
### 상품 서비스에서 Spin Lock을 활용한 상품 수량 동시성 문제 해결
* 문제
  * 상품 서비스에서 여러 사용자가 동시에 상품 구매를 시도하면서, 상품 수량 수정 시 동시성 문제가 발생했습니다.
 
* 해결
  * Spin Lock을 적용하여 상품 수량을 수정하는 로직에서 동시성 제어를 강화했습니다:

* 결과
  * 상품 수량 수정의 동시성 문제를 해결했습니다.
