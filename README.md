# E-commerce
Kafka 기반의 비동기 메시징과 Spring Cloud 기반의 MSA 아키텍처를 적용한 이커머스 프로젝트입니다. MSA 환경에서의 서비스 간 통신, 동시성 제어, 데이터 정합성 유지 등 실무에서 자주 마주치는 문제를 직접 설계하고 해결한 경험을 담았습니다.

# 프로젝트 구조
![msa 구성도 예시](https://github.com/user-attachments/assets/448c8e92-a30b-42ca-80b5-9e379c7777bd)

## 🔧 기술 스택

| 분류 | 기술 | 설명 |
|------|------|------|
| Frontend | Vue.js, TypeScript | 사용자 화면 구성 |
| Backend | Spring Boot 3.3, Spring Data JPA, Spring Cloud Gateway, Spring Cloud Config | MSA 구조 기반 서비스 구성 |
| Database | H2 (개발용) | 관계형 DB |
| Cache | Redis | 데이터 캐싱, 토큰 저장 등 |
| Messaging | Kafka, RabbitMQ | 서비스 간 메시지 통신 및 설정 동기화 |


 ## ⚙ 서비스 기능

### user-service
**설명**: 회원가입, 로그인, 배송지 관리 등 사용자 정보와 관련된 기능을 담당합니다.  

**주요 기능**
- 회원가입
- 로그인
- 로그아웃
- 내 정보 조회
- 배송지 관리
  - 배송지 추가/수정/삭제
  - 기본 배송지 설정 기능 포함

---

### 📦 item-service
**설명**: 상품 등록/조회/수정/삭제 및 재고 관리 기능을 제공합니다.  

**주요 기능**
- 상품 등록 / 수정 / 삭제
- 상품 목록 조회 (카테고리, 키워드 등 필터 지원)
- 상품 상세 조회
- 재고 증가 및 감소
  - Spin Lock을 적용해 동시성 문제 해결

---

### 🛒 order-service
**설명**: 장바구니 및 주문 생성을 담당합니다. Kafka를 통해 결제 서비스와 연동됩니다.  

**주요 기능**
- 장바구니 담기 / 수정 / 삭제
- 주문 생성
  - Kafka로부터 결제 완료 메시지를 수신
  - 재고 확인 후 주문 생성
- 주문 취소
  - Kafka로 결제 취소 메시지를 발행

---

### 💳 pay-service
**설명**: 결제 요청을 처리하며, Kafka를 통해 주문 서비스와 통신합니다.  

**주요 기능**
- 결제 요청 검증 (금액, 사용자, 장바구니 정보 등)
- 결제 승인 처리
  - Kafka에 주문 생성 요청 메시지 발행
- 결제 실패 또는 주문 실패 시 보상 트랜잭션 처리
  - Kafka를 통해 결제 취소 메시지 발행

---

### 📝 review-service
**설명**: 상품에 대한 사용자 리뷰를 관리합니다.  

**주요 기능**
- 리뷰 등록
- 리뷰 수정
- 리뷰 삭제
- 리뷰 평점
- 내 리뷰 조회

---

### 🖼 image-service
**설명**: 상품 및 리뷰 이미지 업로드/삭제 기능을 제공합니다.  

**주요 기능**
- 이미지 업로드
- 이미지 수정
- 이미지 삭제
 
#  문제 해결 사례

### 1. Kafka 기반 결제-주문 분산 트랜잭션 처리

**문제**  
결제 서비스와 주문 서비스가 분산 환경에서 독립적으로 동작하다 보니, 데이터 정합성을 유지하기 어려웠습니다.  
예를 들어 결제는 완료되었지만 주문 생성이 실패하거나, 주문은 생성되었지만 결제가 이루어지지 않는 문제가 발생했습니다.

**해결**  
Kafka 기반 이벤트 시스템과 SAGA 패턴을 적용해 다음과 같이 처리했습니다:
1. 결제가 완료되면 Kafka 토픽에 결제 완료 메시지를 발행합니다.
2. 주문 서비스는 해당 메시지를 구독하여 주문 생성을 처리합니다.
3. 주문 생성에 실패하면 Kafka를 통해 결제 취소 이벤트를 발행하고 결제 상태를 롤백합니다.

**결과**  
- 결제와 주문 서비스 간 상태 동기화가 안정적으로 이루어졌습니다.
- 장애 발생 시 자동으로 롤백되어 데이터 정합성이 보장되었습니다.

---

### 2. 상품 수량 동시성 제어 (Spin Lock 적용)

**문제**  
여러 사용자가 동시에 같은 상품을 구매할 경우, 재고 수량이 정확하게 반영되지 않아 Race Condition 문제가 발생했습니다.

**해결**  
Spin Lock을 도입하여 재고 차감 로직을 임계 구역으로 설정했습니다.  
다중 요청이 동시에 들어와도 순차적으로 처리되도록 로직을 구성했습니다.

**결과**  
- 동시성 문제 없이 안정적으로 재고 수량이 반영되었습니다.
- 재고 처리에 대한 신뢰성과 일관성이 확보되었습니다.
